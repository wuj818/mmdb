<% if @person.movie_rating_history.length > 1 %>
  <script src='http://www.google.com/jsapi' type='text/javascript'></script>
  <script type='text/javascript'>
    google.load('visualization', '1', {'packages': ['corechart']});
    google.setOnLoadCallback(drawChart);

    function drawChart() {
      var data = new google.visualization.DataTable();
      data.addRows(<%= @person.movie_rating_history.length %>);
      data.addColumn('string', 'Year');
      data.addColumn('number', 'Average Rating');
      data.addColumn('number', 'Movies');

      <% @person.movie_rating_history.each_with_index do |data, i| %>
        data.setValue(<%= i %>, 0, '<%= data.year %>');
        data.setValue(<%= i %>, 1, <%= format('%.2f', data.average) %>);
        data.setValue(<%= i %>, 2, <%= data.total %>);
      <% end %>

      var geomap = new google.visualization.LineChart(document.getElementById('movie_rating_history'));
      geomap.draw(data, {
        width: 960, height: 400, fontSize: 10,
        title: '<%= "#{@person.name} - Movie History" %>', curveType: 'function',
        hAxis: {slantedText: true, slantedTextAngle: 90},
        vAxis: {maxValue: 10, minValue: 0},
        titleTextStyle: {fontSize: 18},
        tooltipTextStyle: {fontSize: 14},
        legendTextStyle: {fontSize: 12}
      });
    };
  </script>
<% end %>