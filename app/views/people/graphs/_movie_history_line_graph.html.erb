<% if @person.movies.length > 1 %>
  <script type='text/javascript'>
    google.setOnLoadCallback(drawChart);

    function drawChart() {
      var data = new google.visualization.DataTable();
      <% all_years = ((@person.movie_history.first.year)..(@person.movie_history.last.year)).to_a %>
      <% year_data = {} %>
      <% @person.movie_history.each do |data| %>
        <% year_data[data.year] = { average: format('%.2f', data.average), total: data.total } %>
      <% end %>
      data.addRows(<%= all_years.length %>);
      data.addColumn('string', 'Year');
      data.addColumn('number', 'Average Rating');
      data.addColumn('number', 'Movies');

      <% all_years.each_with_index do |year, i| %>
        data.setValue(<%= i %>, 0, '<%= year %>');
        data.setValue(<%= i %>, 1, <%= year_data[year].blank? ? 'null' : year_data[year][:average] %>);
        data.setValue(<%= i %>, 2, <%= year_data[year].blank? ? 0 : year_data[year][:total] %>);
      <% end %>

      var lineChart = new google.visualization.LineChart(document.getElementById('movie-history-line-graph'));
      lineChart.draw(data, {
        width: 940, height: 400, fontSize: 10,
        title: 'Movie History',
        legend: 'top',
        chartArea: { width: 880, height: 300 },
        hAxis: { slantedText: true, slantedTextAngle: 45 },
        vAxis: { maxValue: 10, minValue: 0 },
        titleTextStyle: { fontSize: 18 },
        tooltipTextStyle: { fontSize: 14 },
        legendTextStyle: { fontSize: 12 },
        interpolateNulls: true,
        pointSize: 6
      });
    };
  </script>
<% end %>
